import {
  customOscillators as baseOscillators,
  customOscillatorTypes as baseTypes,
} from "web-audio-oscillators";

const WAVEFORMS = {
  semisine: {
    real: [
      0,
      -0.3333333432674408,
      -0.06666667014360428,
      -0.02857142873108387,
      -0.01587301678955555,
      -0.010101010091602802,
      -0.00699300691485405,
      -0.0051282052882015705,
      -0.003921568859368563,
      -0.0030959751456975937,
      -0.002506265649572015,
      -0.0020703934133052826,
      -0.0017391304718330503,
      -0.00148148147854954,
      -0.0012771391775459051,
      -0.0011123470030725002,
      -0.0009775171056389809,
      -0.0008658008882775903,
      -0.00077220075763762,
      -0.0006930006784386933,
      -0.0006253908504731953,
      -0.0005672149709425867,
      -0.0005167958443053067,
      -0.00047281323350034654,
      -0.00043421622831374407,
      -0.0004001600609626621,
      -0.0003699593071360141,
      -0.0003430531651247293,
      -0.0003189792623743415,
      -0.0002973535447381437,
      -0.00027785496786236763,
      -0.00026021336088888347,
      -0.00024420025874860585,
      -0.00022962113143876195,
      -0.00021630975243169814,
      -0.000204123294679448,
      -0.0001929384598042816,
      -0.00018264840764459223,
      -0.00017316016601398587,
      -0.0001643925643293187,
      -0.00015627441462129354,
      -0.00014874311455059797,
      -0.0001417434395989403,
      -0.0001352265098830685,
      -0.00012914890248794109,
      -0.00012347204028628767,
      -0.00011816140613518655,
      -0.0001131861936300993,
      -0.00010851871775230393,
      -0.0001041341238305904,
      -0.00010001000191550702,
      -0.00009612611756892875,
      -0.00009246417175745592,
      -0.00008900756802177057,
      -0.00008574123057769611,
      -0.00008265145879704505,
      -0.0000797257453086786,
      -0.0000769526741351001,
      -0.00007432181155309081,
      -0.00007182360423030332,
      -0.0000694492700858973,
      -0.00006719075463479385,
      -0.00006504065095214173,
      -0.00006299212691374123,
    ],
    imag: Array(64).fill(0),
  },
  warm: {
    real: Array(101).fill(0),
    imag: [
      0,
      1,
      0.3535533845424652,
      0,
      0.125,
      0,
      0,
      0.1079898476600647,
      0.04419417306780815,
      0,
      0,
      0.05482024326920509,
      0,
      0,
      0.03818017616868019,
      0,
      0.015625,
      0,
      0,
      0,
      0,
      0,
      0.01938188262283802,
      0,
      0,
      0,
      0,
      0,
      0.013498730957508087,
      0,
      0,
      0,
      0.005524271633476019,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0.006852530408650637,
      0,
      0,
      0,
      0,
      0.0058309040032327175,
      0,
      0,
      0,
      0,
      0,
      0,
      0.004772522021085024,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0.001953125,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0.0029600150883197784,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0.0024227353278547525,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0.0020615358371287584,
      0,
      0,
    ],
  },
};

const localOscillators = Object.fromEntries(
  Object.entries(WAVEFORMS).map(([name, { real, imag }]) => [
    name,
    (audioCtx) => {
      const oscillator = audioCtx.createOscillator();
      const wave = audioCtx.createPeriodicWave(
        new Float32Array(real),
        new Float32Array(imag)
      );
      oscillator.setPeriodicWave(wave);
      return oscillator;
    },
  ])
);

const EXCLUDED_TYPES = new Set([
  "brass",
  "brass2",
  "aah",
  "ooh",
  "eeh",
  "buzz",
  "buzz2",
  "dissonance",
]);

const baseList = (baseTypes || []).filter((type) => !EXCLUDED_TYPES.has(type));
const warmIndex = baseList.indexOf("sine");
const warmInsertAt = warmIndex >= 0 ? warmIndex + 1 : 0;
const customOrder = ["semisine", "warm"];
const orderedList = [
  ...baseList.slice(0, warmInsertAt),
  ...customOrder,
  ...baseList.slice(warmInsertAt).filter((type) => !customOrder.includes(type)),
];
const uniqueTypes = Array.from(new Set(orderedList));

export const customOscillatorTypes = uniqueTypes;

export const customOscillators = {
  ...(baseOscillators || {}),
  ...localOscillators,
};
